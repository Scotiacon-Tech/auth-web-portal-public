import{T as h}from"./A4W5cgAN.js";import{a0 as T,T as y,r as p,q as C,aS as $,a9 as w,a8 as g,V as i,o as A,Y as b,w as a,b as o,d as B,W as I,aQ as S,X as x,aa as N}from"./CAOQfWXx.js";import{u as R}from"./seZSGpOe.js";import{V as D,a as U,b as z,c as L}from"./CNTE2ays.js";import{d as M}from"./_SDtMKP-.js";import{V as E,a as f}from"./DCZf9yjN.js";import{V as O,a as Y}from"./vZh8RZA5.js";import"./B5CZD0j7.js";import"./lKELra2E.js";import"./B_xljH0v.js";import"./BpP4Qw09.js";import"./PLM72-m0.js";import"./CMk-CyOM.js";import"./Dv4wpn87.js";const q=()=>h.getInstance(),Q=async()=>{const u=T(),t=h.getInstance().getTokenByService("graze");return await $fetch(`${u.public.issuerUri}/api/access_check`,{method:"get",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`}})},re=y({__name:"admin",async setup(u){let r,t;const s=p(!1),{xs:k}=C(),c=$(),m=q(),d=p(!1),v=()=>{c.global.name.value=c.global.current.value.dark?"light":"dark"};try{[r,t]=w(()=>Q()),r=await r,t(),r&&(d.value=!0)}catch(n){const e=n;(e.message.includes("401")||e.message.includes("403"))&&(m.removeTokensByService("graze"),g(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const V=async()=>{const n=N(),e=await R(),l=encodeURIComponent(`${window.location.origin}${n.resolve("/admin").href}`),_=`${e.EndSessionEndpoint}?client_id=internal&post_logout_redirect_uri=${l}`;m.removeTokensByService("graze"),g(_,{external:!0})};return(n,e)=>i(d)?(A(),b(Y,{key:0},{default:a(()=>[o(z,{color:"primary","scroll-behavior":"collapse"},{default:a(()=>[o(D,null,{default:a(()=>e[2]||(e[2]=[B("Dashboard")])),_:1}),o(M),o(U,{onClick:e[0]||(e[0]=l=>s.value=!i(s))})]),_:1}),o(L,{modelValue:i(s),"onUpdate:modelValue":e[1]||(e[1]=l=>I(s)?s.value=l:null),location:i(k)?"top":"right",temporary:""},{default:a(()=>[o(E,null,{default:a(()=>[o(f,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:v,title:`${i(c).global.name.value=="dark"?"Light":"Dark"} Mode`},null,8,["title"]),o(f,{"prepend-icon":"mdi:mdi-logout",onClick:V,title:"Logout"})]),_:1})]),_:1},8,["modelValue","location"]),o(O,null,{default:a(()=>[S(n.$slots,"default")]),_:3})]),_:3})):x("",!0)}});export{re as default};
