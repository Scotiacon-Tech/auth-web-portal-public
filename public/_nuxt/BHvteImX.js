import{u as $,s as u}from"./DdjfN0l3.js";import{u as N,H as A,T as I,a1 as J,r as d,o as m,J as E,w as f,R,N as r,b as w,L as y,c as x,t as p,Q as U,a as b}from"./DvixYH9T.js";import{a as L}from"./DuaSZ-y1.js";import{V as q}from"./Bwjt_S9n.js";import{a as B,V as O}from"./Bj0IWiKA.js";import{b as P}from"./HyvrZmyD.js";import"./5dxMDfVn.js";import"./DHrUxnTR.js";/* empty css        */import"./Ct6Uo_IL.js";import"./AbBJySgT.js";const T=async(h,i,a,t,e=!1)=>{const o=N();try{return await $fetch(`${o.public.issuerUri}/connect/auth/${t}`,{method:"post",body:JSON.stringify({oauth:h,external:{code:i,redirect_uri:a},new:e}),parseResponse:_=>{const l=JSON.parse(_);return{create_token:l.CreateToken?l.CreateToken:"",redirect_uri:l.RedirectURI?l.RedirectURI:""}}})}catch{return""}},z=async(h,i)=>{const a=N();try{return await $fetch(`${a.public.issuerUri}/connect/auth/create`,{method:"post",body:JSON.stringify({oauth:h,create_token:i,new:!0}),parseResponse:t=>{const e=JSON.parse(t);if(e.RedirectURI)return e.RedirectURI;throw t}})}catch{return""}},D={key:0,class:"my-2"},H={key:1,class:"my-2"},M={key:2,class:"my-2"},Q={class:"my-2"},j={class:"my-2"},ne=A({__name:"[method]",setup(h){const i=I(),a=J(),t=d(""),e=d(!1),o=d(!1),_=d(),{getState:l}=$(),g=l(a.query.state,!0),k=d(""),V=()=>{R(g.RedirectUri,{external:!0})},S=async()=>{const n=await z(g,k.value);if(n){const s=new URL(n).searchParams.get("error");s?s=="access_denied"&&(e.value=!0,t.value=3):R(n,{external:!0})}else e.value=!0,t.value=2};return g?(async()=>{const n=a.query.code,c=`${window.location.origin}${i.resolve("/connect/external").href}/keycloak`,{create_token:s,redirect_uri:C}=await T(g,n,c,a.params.method,!1);if(s&&(k.value=s),C){const v=new URL(C).searchParams.get("error");v?v=="access_denied"?(o.value=!0,_.value=n):v=="invalid_request"?(e.value=!0,t.value=1):v=="server_error"&&(e.value=!0,t.value=2):R(C,{external:!0})}else e.value=!0,t.value=2})():(e.value=!0,t.value=2),(n,c)=>(m(),E(q,{class:"h-100"},{default:f(()=>[!r(o)&&!r(e)?(m(),E(B,{key:0,class:"h-100"},{default:f(()=>[w(O,{class:"text-center align-content-center"},{default:f(()=>[w(P,{color:"primary",size:110,width:12,indeterminate:""})]),_:1})]),_:1})):y("",!0),w(L,{modelValue:r(e),"onUpdate:modelValue":c[0]||(c[0]=s=>U(e)?e.value=s:null),"show-save-action":!1,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Error Attempting Login","hide-extension":!0,"remove-button-spacer":!0,"close-action-label":"Close",onClose:V},{default:f(()=>[r(t)===1?(m(),x("p",D,p(r(u).messageCreateExternalError1),1)):y("",!0),r(t)===2?(m(),x("p",H,p(r(u).messageCreateExternalError2),1)):y("",!0),r(t)===3?(m(),x("p",M,p(r(u).messageCreateExternalError3),1)):y("",!0)]),_:1},8,["modelValue"]),w(L,{modelValue:r(o),"onUpdate:modelValue":c[1]||(c[1]=s=>U(o)?o.value=s:null),"show-save-action":!0,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Create new account","hide-extension":!0,"save-button-label":"Create Account",persistent:!0,"retain-focus":!0,onSave:S,onClose:V},{default:f(()=>[b("p",Q,p(r(u).messageCreateExternalAccount1),1),b("p",j,p(r(u).messageCreateExternalAccount2),1)]),_:1},8,["modelValue"])]),_:1}))}});export{ne as default};
