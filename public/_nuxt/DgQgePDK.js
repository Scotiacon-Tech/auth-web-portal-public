import{T as O}from"./BwMHTV5E.js";import{u as L,m as j,n as B,r as g,o as T,p as E,w as l,b as t,q as Z,s as a,v as ee,g as M,c as z,x as te,d as m,t as A,y as x,z as le,a as U,F as R,A as ne,B as ae,C as ie}from"./BGiLZV0E.js";import{V as N,a as oe,_ as re,l as _,b as G,c as H,d as J,e as K,f as P,g as Q,h as ue,i as se,j as de}from"./C3C0-8B_.js";import{V as q,a as F,b as ce}from"./CL1lDOKn.js";import{V as D}from"./DLyoCXn1.js";import{V as I}from"./DP5jEFhV.js";import"./Vbk6cZl4.js";import"./BRmzI386.js";const me=async()=>{const $=L(),v=O.getInstance().getTokenByService("graze");return await $fetch(`${$.public.issuerUri}/api/clients`,{method:"get",headers:{Authorization:`Bearer ${v==null?void 0:v.OAuthToken.AccessToken}`}})},ve=j({__name:"EditClientForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup($){const d=B($,"modelValue"),v=L(),f=g({required:r=>!!r||"Required."}),C=()=>f.value.required(d.value.name)===!0;return(r,p)=>(T(),E(oe,{onSubmit:Z(C,["stop"]),id:"login-form",action:`/${a(v).public.issuerUri}/api/clients`,method:"post"},{default:l(()=>[t(F,null,{default:l(()=>[t(q,{cols:"12"},{default:l(()=>[t(N,{modelValue:d.value.name,"onUpdate:modelValue":p[0]||(p[0]=V=>d.value.name=V),label:"Name",variant:"outlined",required:"",rules:[f.value.required]},null,8,["modelValue","rules"])]),_:1}),t(q,{cols:"12"},{default:l(()=>[t(N,{modelValue:d.value.description,"onUpdate:modelValue":p[1]||(p[1]=V=>d.value.description=V),label:"Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(q,{cols:"12"},{default:l(()=>[t(N,{modelValue:d.value.redirect_uri,"onUpdate:modelValue":p[2]||(p[2]=V=>d.value.redirect_uri=V),label:"Redirect URL",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["action"]))}}),S="00000000-0000-0000-0000-000000000000",fe=j({__name:"ClientDialog",props:{modelValue:{required:!1},modelModifiers:{},clients:{required:!0},clientsModifiers:{},"request-delete":{type:Boolean,required:!1},"request-deleteModifiers":{}},emits:ee(["error","secret"],["update:modelValue","update:clients","update:request-delete"]),setup($,{emit:d}){const v=d,f=L(),C=O.getInstance(),r=B($,"modelValue"),p=B($,"clients"),V=B($,"request-delete"),i=g(),k=g(!!r.value),w=g(),b=g(""),y=g(!1),c=g(!1);M(r,()=>{var s,e;w.value=void 0,r&&(i.value=_.cloneDeep(r.value),(s=i.value)!=null&&s.client_uuid&&((e=i.value)==null?void 0:e.client_uuid)!==S&&(w.value=()=>{c.value=!0})),k.value=!!r.value}),M(V,()=>{V.value&&(c.value=!0)}),M(c,()=>{c.value||(V.value=!1)});const o=(s,e=!1)=>{if(!s)return;const n=p.value.findIndex(X=>X.client_uuid==s.client_uuid);n>=0?e?p.value.splice(n,1):p.value.splice(n,1,_.cloneDeep(s)):p.value.push(_.cloneDeep(s))},u=async s=>{if(!r.value)return;const e=C.getTokenByService("graze");if(r.value.client_uuid&&r.value.client_uuid!==S)try{await $fetch(`${f.public.issuerUri}/api/client/${r.value.client_uuid}`,{method:"put",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`},body:{Client:i.value}})||v("error","Unexpected error encountered when updating client")}catch(n){v("error",`Error encountered when updating client: ${n}`)}else try{const n=await $fetch(`${f.public.issuerUri}/api/clients`,{method:"post",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`},body:{Client:i.value}});i.value=n.Client,o(i.value),y.value=!0,b.value=n.Secret}catch(n){v("error",`Error encountered when removing client: ${n}`)}r.value=void 0},h=async()=>{if(!r.value||!r.value.client_uuid)return;const s=C.getTokenByService("graze");try{await $fetch(`${f.public.issuerUri}/api/client/${r.value.client_uuid}`,{method:"delete",headers:{Authorization:`Bearer ${s==null?void 0:s.OAuthToken.AccessToken}`}})&&o(r.value,!0)}catch(e){v("error",`Error encountered when removing client: ${e}`)}r.value=void 0},Y=async()=>{try{navigator.clipboard&&await navigator.clipboard.writeText(b.value)}catch(s){console.error(s.message)}},W=async({callback:s})=>{const e=C.getTokenByService("graze");try{const n=await $fetch(`${f.public.issuerUri}/api/client/${r.value.client_uuid}/secret`,{method:"get",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`}});n&&(y.value=!0,b.value=n.Secret)}catch(n){v("error",`Error encountered when removing client: ${n}`)}await s()};return(s,e)=>(T(),z(R,null,[t(G,{modelValue:a(k),"onUpdate:modelValue":e[1]||(e[1]=n=>x(k)?k.value=n:null),onClose:e[2]||(e[2]=n=>r.value=void 0),onReset:e[3]||(e[3]=n=>i.value=a(_.cloneDeep)(r.value)),onSave:u,onDelete:a(w),"hide-extension":!0,"show-save-action":!0,"show-reset-action":!0,"show-close-action":!0,"close-action-label":a(i)&&a(i).client_uuid&&a(i).client_uuid!==a(S)?"Close":"Cancel"},te({default:l(()=>[a(i)?(T(),E(ve,{key:0,modelValue:a(i),"onUpdate:modelValue":e[0]||(e[0]=n=>x(i)?i.value=n:null)},null,8,["modelValue"])):le("",!0)]),_:2},[a(i)?{name:"title",fn:l(()=>[m(A(`${a(i).client_uuid&&a(i).client_uuid!==a(S)?`Edit: ${a(i).name}`:"Create Client"}`),1)]),key:"0"}:void 0,a(i)&&a(i).client_uuid&&a(i).client_uuid!==a(S)?{name:"actions",fn:l(()=>[t(re,{color:"red-darken-1",variant:"text",onClick:W},{default:l(()=>e[11]||(e[11]=[m(" Regenerate Secret ")])),_:1})]),key:"1"}:void 0]),1032,["modelValue","onDelete","close-action-label"]),t(G,{modelValue:a(y),"onUpdate:modelValue":e[4]||(e[4]=n=>x(y)?y.value=n:null),"show-close-action":!0,"close-action-label":"Close","hide-extension":!0,title:"New Client Secret",onClose:e[5]||(e[5]=n=>{y.value=!1,b.value=""}),onSave:e[6]||(e[6]=n=>{y.value=!1,b.value=""})},{default:l(()=>[e[12]||(e[12]=U("p",{class:"mb-4"}," The following secret was generated, it will not be displayed again: ",-1)),U("p",null,[U("span",{onClick:Y,class:"cursor-pointer"},A(a(b)),1),t(D,{"append-icon":"mdi:mdi-clipboard-outline",size:"medium",variant:"text",class:"ml-3",onClick:Y})])]),_:1},8,["modelValue"]),t(ue,{modelValue:a(c),"onUpdate:modelValue":e[10]||(e[10]=n=>x(c)?c.value=n:null)},{default:l(()=>[t(H,{color:"error"},{default:l(()=>[t(J,null,{default:l(()=>[t(K,{class:"d-flex"},{default:l(()=>[e[13]||(e[13]=m(" Confirmation Required ")),t(I),t(D,{icon:"mdi:mdi-close",size:"x-small",variant:"text",onClick:e[7]||(e[7]=n=>c.value=!1)})]),_:1})]),_:1}),t(P,null,{default:l(()=>e[14]||(e[14]=[U("p",{class:"mb-4"},"Are you sure you wish to delete this client?",-1),U("p",null,"Any services logging in with this client identity and secret will cease to function.",-1)])),_:1}),t(Q,null,{default:l(()=>[t(D,{onClick:e[8]||(e[8]=n=>c.value=!1)},{default:l(()=>e[15]||(e[15]=[m(" Close Dialog ")])),_:1}),t(I),t(D,{onClick:e[9]||(e[9]=n=>{c.value=!1,h()})},{default:l(()=>e[16]||(e[16]=[m(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),be=j({__name:"dashboard",async setup($){let d,v;const f=g(),C=g(!1),r=g(""),p=ne(),V=O.getInstance(),i=V.getTokenByService("graze");(!i||V.accessTimeRemaining(i)<=0)&&p.push("/admin");const k=g([]),w=g(!1);try{k.value=([d,v]=ae(()=>me()),d=await d,v(),d)}catch(c){c.message.includes("403")&&(V.removeTokensByService("graze"),p.push("/admin?error=access_denied&error_description=You are not authorised to access this service."))}const b=()=>({id:0,client_uuid:S,name:"",description:"",secret:"",redirect_uri:"",style:{}}),y=c=>{r.value=c,C.value=!0};return(c,o)=>(T(),E(ce,null,{default:l(()=>[t(F,null,{default:l(()=>[t(q,null,{default:l(()=>[(T(!0),z(R,null,ie(a(k),u=>(T(),E(H,{color:"grey-lighten-3",variant:"elevated",elevation:"16"},{default:l(()=>[t(J,null,{default:l(()=>[t(K,null,{default:l(()=>[m(A(u.name),1)]),_:2},1024),t(de,null,{default:l(()=>[m(A(u.description),1)]),_:2},1024)]),_:2},1024),t(P,null,{default:l(()=>[o[6]||(o[6]=m(" RedirectURL: ")),u.redirect_uri?(T(),z(R,{key:0},[m(A(u.redirect_uri),1)],64)):(T(),z(R,{key:1},[m(" Unset ")],64))]),_:2},1024),t(Q,null,{default:l(()=>[t(D,{color:"error","prepend-icon":"mdi:mdi-delete",variant:"elevated",onClick:h=>{f.value=u,w.value=!0}},{default:l(()=>o[7]||(o[7]=[m(" Delete ")])),_:2},1032,["onClick"]),t(I),t(D,{color:"primary","prepend-icon":"mdi:mdi-pencil",variant:"elevated",onClick:h=>f.value=u},{default:l(()=>o[8]||(o[8]=[m(" Edit ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),t(F,null,{default:l(()=>[t(q,{class:"text-right"},{default:l(()=>[t(D,{"prepend-icon":"mdi:mdi-plus",color:"primary",onClick:o[0]||(o[0]=u=>f.value=b())},{default:l(()=>o[9]||(o[9]=[m(" Add Client ")])),_:1})]),_:1})]),_:1}),t(fe,{modelValue:a(f),"onUpdate:modelValue":o[1]||(o[1]=u=>x(f)?f.value=u:null),clients:a(k),"onUpdate:clients":o[2]||(o[2]=u=>x(k)?k.value=u:null),requestDelete:a(w),"onUpdate:requestDelete":o[3]||(o[3]=u=>x(w)?w.value=u:null),onError:y},null,8,["modelValue","clients","requestDelete"]),t(se,{modelValue:a(C),"onUpdate:modelValue":o[5]||(o[5]=u=>x(C)?C.value=u:null),timeout:5e3,"multi-line":""},{actions:l(()=>[t(D,{color:"white",variant:"text",onClick:o[4]||(o[4]=u=>C.value=!1)},{default:l(()=>o[10]||(o[10]=[m(" Close ")])),_:1})]),default:l(()=>[m(A(a(r))+" ",1)]),_:1},8,["modelValue"])]),_:1}))}});export{be as default};
