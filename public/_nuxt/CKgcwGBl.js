import"./B5CZD0j7.js";import{a0 as g}from"./CAOQfWXx.js";const h=typeof Buffer=="function",p=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A=Array.prototype.slice.call(m),d=(e=>{let o={};return e.forEach((t,n)=>o[t]=n),o})(A),k=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,a=String.fromCharCode.bind(String),u=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),w=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),b=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,y=e=>{switch(e.length){case 4:var o=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),t=o-65536;return a((t>>>10)+55296)+a((t&1023)+56320);case 3:return a((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return a((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},T=e=>e.replace(b,y),C=e=>{if(e=e.replace(/\s+/g,""),!k.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let o,t="",n,i;for(let c=0;c<e.length;)o=d[e.charAt(c++)]<<18|d[e.charAt(c++)]<<12|(n=d[e.charAt(c++)])<<6|(i=d[e.charAt(c++)]),t+=n===64?a(o>>16&255):i===64?a(o>>16&255,o>>8&255):a(o>>16&255,o>>8&255,o&255);return t},x=typeof atob=="function"?e=>atob(w(e)):h?e=>Buffer.from(e,"base64").toString("binary"):C,S=h?e=>u(Buffer.from(e,"base64")):e=>u(x(e).split("").map(o=>o.charCodeAt(0))),E=h?e=>Buffer.from(e,"base64").toString("utf8"):p?e=>p.decode(S(e)):e=>T(x(e)),I=e=>w(e.replace(/[-_]/g,o=>o=="-"?"+":"/")),B=e=>E(I(e));function F(e=""){if(!e&&(e=window.localStorage.getItem("sso_access_token")||"",!e))throw new Error("invalid token");const o=e.split(".");if(o.length!==3)throw new Error("Invalid JWT token");let t="";try{t=B(o[1])}catch(n){throw console.error(o[1]),n}return JSON.parse(t)}function U(e){const o=F(e);if(!o.exp)throw new Error("JWT does not contain an exp claim");const t=Math.floor(Date.now()/1e3);return o.exp<t}const R=()=>{const e=()=>{const r=window.localStorage;r.removeItem("sso_access_token"),r.removeItem("sso_refresh_token")},o=r=>{window.localStorage.setItem("sso_access_token",r)},t=r=>{window.localStorage.setItem("sso_refresh_token",r)},n=()=>{const r=window.localStorage,s=r.getItem("sso_access_token");if(!s||U(s))throw r.removeItem("sso_access_token"),new Error("No valid access token available");return s},i=()=>window.localStorage.getItem("sso_refresh_token");return{logout:e,storeAccessToken:o,storeRefreshToken:t,getAccessToken:n,getRefreshToken:i,renewToken:async()=>{const r=g();console.log("performRenew");const s=i();console.log(s);const l=new URLSearchParams;return l.append("grant_type","refresh_token"),l.append("refresh_token",s||""),l.append("client_id","internal"),await $fetch(`${r.public.issuerUri}/connect/token/refresh`,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l.toString(),parseResponse:_=>{const f=JSON.parse(_);return f.access_token&&o(f.access_token),f.refresh_token&&t(f.refresh_token),f}})}}};export{F as g,R as u};
