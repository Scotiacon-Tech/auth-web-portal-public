import{T as F}from"./BI-YbJ1O.js";import{u as O,m as L,n as _,r as g,o as w,p as R,w as l,b as t,q as ee,s as o,v as te,g as h,c as B,x as le,d as m,t as D,y as b,z as ne,a as U,F as z,A as Y,B as ae,C as ie}from"./DeSjSsFf.js";import{V as M,a as oe,_ as re,l as q,b as G,c as H,d as J,e as K,f as P,g as Q,h as ue,i as se,j as de}from"./B_I59mqq.js";import{V as A,a as I}from"./CsDk6a1A.js";import{V as T}from"./DS2tMJez.js";import{V as N}from"./DH5Ij0SZ.js";import{V as ce}from"./BEQt3LR9.js";import"./BpntLZXx.js";import"./BwL7h9y5.js";import"./CkHVVh67.js";/* empty css        */const me=async()=>{const $=O(),v=F.getInstance().getTokenByService("graze");return await $fetch(`${$.public.issuerUri}/api/clients`,{method:"get",headers:{Authorization:`Bearer ${v==null?void 0:v.OAuthToken.AccessToken}`}})},ve=L({__name:"EditClientForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup($){const d=_($,"modelValue"),v=O(),f=g({required:r=>!!r||"Required."}),C=()=>f.value.required(d.value.name)===!0;return(r,c)=>(w(),R(oe,{onSubmit:ee(C,["stop"]),id:"login-form",action:`/${o(v).public.issuerUri}/api/clients`,method:"post"},{default:l(()=>[t(I,null,{default:l(()=>[t(A,{cols:"12"},{default:l(()=>[t(M,{modelValue:d.value.name,"onUpdate:modelValue":c[0]||(c[0]=p=>d.value.name=p),label:"Name",variant:"outlined",required:"",rules:[f.value.required]},null,8,["modelValue","rules"])]),_:1}),t(A,{cols:"12"},{default:l(()=>[t(M,{modelValue:d.value.description,"onUpdate:modelValue":c[1]||(c[1]=p=>d.value.description=p),label:"Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(A,{cols:"12"},{default:l(()=>[t(M,{modelValue:d.value.redirect_uri,"onUpdate:modelValue":c[2]||(c[2]=p=>d.value.redirect_uri=p),label:"Redirect URL",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["action"]))}}),x="00000000-0000-0000-0000-000000000000",fe=L({__name:"ClientDialog",props:{modelValue:{required:!1},modelModifiers:{},clients:{required:!0},clientsModifiers:{},"request-delete":{type:Boolean,required:!1},"request-deleteModifiers":{}},emits:te(["error","secret"],["update:modelValue","update:clients","update:request-delete"]),setup($,{emit:d}){const v=d,f=O(),C=F.getInstance(),r=_($,"modelValue"),c=_($,"clients"),p=_($,"request-delete"),i=g(),k=g(!!r.value),S=g(),y=g(""),V=g(!1),n=g(!1);h(r,()=>{var s,e;S.value=void 0,r&&(i.value=q.cloneDeep(r.value),(s=i.value)!=null&&s.client_uuid&&((e=i.value)==null?void 0:e.client_uuid)!==x&&(S.value=()=>{n.value=!0})),k.value=!!r.value}),h(p,()=>{p.value&&(n.value=!0)}),h(n,()=>{n.value||(p.value=!1)});const u=(s,e=!1)=>{if(!s)return;const a=c.value.findIndex(Z=>Z.client_uuid==s.client_uuid);a>=0?e?c.value.splice(a,1):c.value.splice(a,1,q.cloneDeep(s)):c.value.push(q.cloneDeep(s))},E=async s=>{if(!r.value)return;const e=C.getTokenByService("graze");if(r.value.client_uuid&&r.value.client_uuid!==x)try{await $fetch(`${f.public.issuerUri}/api/client/${r.value.client_uuid}`,{method:"put",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`},body:{Client:i.value}})||v("error","Unexpected error encountered when updating client")}catch(a){v("error",`Error encountered when updating client: ${a}`)}else try{const a=await $fetch(`${f.public.issuerUri}/api/clients`,{method:"post",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`},body:{Client:i.value}});i.value=a.Client,u(i.value),V.value=!0,y.value=a.Secret}catch(a){v("error",`Error encountered when removing client: ${a}`)}r.value=void 0},W=async()=>{if(!r.value||!r.value.client_uuid)return;const s=C.getTokenByService("graze");try{await $fetch(`${f.public.issuerUri}/api/client/${r.value.client_uuid}`,{method:"delete",headers:{Authorization:`Bearer ${s==null?void 0:s.OAuthToken.AccessToken}`}})&&u(r.value,!0)}catch(e){v("error",`Error encountered when removing client: ${e}`)}r.value=void 0},j=async()=>{try{navigator.clipboard&&await navigator.clipboard.writeText(y.value)}catch(s){console.error(s.message)}},X=async({callback:s})=>{const e=C.getTokenByService("graze");try{const a=await $fetch(`${f.public.issuerUri}/api/client/${r.value.client_uuid}/secret`,{method:"get",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`}});a&&(V.value=!0,y.value=a.Secret)}catch(a){v("error",`Error encountered when removing client: ${a}`)}await s()};return(s,e)=>(w(),B(z,null,[t(G,{modelValue:o(k),"onUpdate:modelValue":e[1]||(e[1]=a=>b(k)?k.value=a:null),onClose:e[2]||(e[2]=a=>r.value=void 0),onReset:e[3]||(e[3]=a=>i.value=o(q.cloneDeep)(r.value)),onSave:E,onDelete:o(S),"hide-extension":!0,"show-save-action":!0,"show-reset-action":!0,"show-close-action":!0,"close-action-label":o(i)&&o(i).client_uuid&&o(i).client_uuid!==o(x)?"Close":"Cancel"},le({default:l(()=>[o(i)?(w(),R(ve,{key:0,modelValue:o(i),"onUpdate:modelValue":e[0]||(e[0]=a=>b(i)?i.value=a:null)},null,8,["modelValue"])):ne("",!0)]),_:2},[o(i)?{name:"title",fn:l(()=>[m(D(`${o(i).client_uuid&&o(i).client_uuid!==o(x)?`Edit: ${o(i).name}`:"Create Client"}`),1)]),key:"0"}:void 0,o(i)&&o(i).client_uuid&&o(i).client_uuid!==o(x)?{name:"actions",fn:l(()=>[t(re,{color:"red-darken-1",variant:"text",onClick:X},{default:l(()=>e[11]||(e[11]=[m(" Regenerate Secret ")])),_:1})]),key:"1"}:void 0]),1032,["modelValue","onDelete","close-action-label"]),t(G,{modelValue:o(V),"onUpdate:modelValue":e[4]||(e[4]=a=>b(V)?V.value=a:null),"show-close-action":!0,"close-action-label":"Close","hide-extension":!0,title:"New Client Secret",onClose:e[5]||(e[5]=a=>{V.value=!1,y.value=""}),onSave:e[6]||(e[6]=a=>{V.value=!1,y.value=""})},{default:l(()=>[e[12]||(e[12]=U("p",{class:"mb-4"}," The following secret was generated, it will not be displayed again: ",-1)),U("p",null,[U("span",{onClick:j,class:"cursor-pointer"},D(o(y)),1),t(T,{"append-icon":"mdi:mdi-clipboard-outline",size:"medium",variant:"text",class:"ml-3",onClick:j})])]),_:1},8,["modelValue"]),t(ue,{modelValue:o(n),"onUpdate:modelValue":e[10]||(e[10]=a=>b(n)?n.value=a:null)},{default:l(()=>[t(H,{color:"error"},{default:l(()=>[t(J,null,{default:l(()=>[t(K,{class:"d-flex"},{default:l(()=>[e[13]||(e[13]=m(" Confirmation Required ")),t(N),t(T,{icon:"mdi:mdi-close",size:"x-small",variant:"text",onClick:e[7]||(e[7]=a=>n.value=!1)})]),_:1})]),_:1}),t(P,null,{default:l(()=>e[14]||(e[14]=[U("p",{class:"mb-4"},"Are you sure you wish to delete this client?",-1),U("p",null,"Any services logging in with this client identity and secret will cease to function.",-1)])),_:1}),t(Q,null,{default:l(()=>[t(T,{onClick:e[8]||(e[8]=a=>n.value=!1)},{default:l(()=>e[15]||(e[15]=[m(" Close Dialog ")])),_:1}),t(N),t(T,{onClick:e[9]||(e[9]=a=>{n.value=!1,W()})},{default:l(()=>e[16]||(e[16]=[m(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),De=L({__name:"dashboard",async setup($){let d,v;const f=g(),C=g(!1),r=g(""),c=F.getInstance(),p=c.getTokenByService("graze");(!p||c.accessTimeRemaining(p)<=0)&&Y("/admin");const i=g([]),k=g(!1);try{i.value=([d,v]=ae(()=>me()),d=await d,v(),d)}catch(V){V.message.includes("403")&&(c.removeTokensByService("graze"),Y(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const S=()=>({id:0,client_uuid:x,name:"",description:"",secret:"",redirect_uri:"",style:{}}),y=V=>{r.value=V,C.value=!0};return(V,n)=>(w(),R(ce,null,{default:l(()=>[t(I,null,{default:l(()=>[t(A,null,{default:l(()=>[(w(!0),B(z,null,ie(o(i),u=>(w(),R(H,{color:"grey-lighten-3",variant:"elevated",elevation:"16"},{default:l(()=>[t(J,null,{default:l(()=>[t(K,null,{default:l(()=>[m(D(u.name),1)]),_:2},1024),t(de,null,{default:l(()=>[m(D(u.description),1)]),_:2},1024)]),_:2},1024),t(P,null,{default:l(()=>[n[6]||(n[6]=m(" RedirectURL: ")),u.redirect_uri?(w(),B(z,{key:0},[m(D(u.redirect_uri),1)],64)):(w(),B(z,{key:1},[m(" Unset ")],64))]),_:2},1024),t(Q,null,{default:l(()=>[t(T,{color:"error","prepend-icon":"mdi:mdi-delete",variant:"elevated",onClick:E=>{f.value=u,k.value=!0}},{default:l(()=>n[7]||(n[7]=[m(" Delete ")])),_:2},1032,["onClick"]),t(N),t(T,{color:"primary","prepend-icon":"mdi:mdi-pencil",variant:"elevated",onClick:E=>f.value=u},{default:l(()=>n[8]||(n[8]=[m(" Edit ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(A,{class:"text-right"},{default:l(()=>[t(T,{"prepend-icon":"mdi:mdi-plus",color:"primary",onClick:n[0]||(n[0]=u=>f.value=S())},{default:l(()=>n[9]||(n[9]=[m(" Add Client ")])),_:1})]),_:1})]),_:1}),t(fe,{modelValue:o(f),"onUpdate:modelValue":n[1]||(n[1]=u=>b(f)?f.value=u:null),clients:o(i),"onUpdate:clients":n[2]||(n[2]=u=>b(i)?i.value=u:null),requestDelete:o(k),"onUpdate:requestDelete":n[3]||(n[3]=u=>b(k)?k.value=u:null),onError:y},null,8,["modelValue","clients","requestDelete"]),t(se,{modelValue:o(C),"onUpdate:modelValue":n[5]||(n[5]=u=>b(C)?C.value=u:null),timeout:5e3,"multi-line":""},{actions:l(()=>[t(T,{color:"white",variant:"text",onClick:n[4]||(n[4]=u=>C.value=!1)},{default:l(()=>n[10]||(n[10]=[m(" Close ")])),_:1})]),default:l(()=>[m(D(o(r))+" ",1)]),_:1},8,["modelValue"])]),_:1}))}});export{De as default};
