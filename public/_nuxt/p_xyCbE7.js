import{s as m}from"./DeTKzWR2.js";import{a0 as U,T as L,aa as $,af as N,r as v,o as p,Y as T,w as h,a8 as C,V as s,b as w,X as R,c as x,t as _,W as V,a as S}from"./CAOQfWXx.js";import{u as A}from"./CKgcwGBl.js";import{j as E}from"./CZ89NzH9.js";import{u as I}from"./CB4RZGcy.js";import{V as q}from"./BGUAx3Eu.js";import{V as O,a as B}from"./8jOmeCJr.js";import{w as J}from"./BpP4Qw09.js";import"./B5CZD0j7.js";import"./_SDtMKP-.js";import"./PLM72-m0.js";import"./B_xljH0v.js";import"./lKELra2E.js";const P=async(g,f,c,t,e=!1)=>{const o=U(),{storeAccessToken:a,storeRefreshToken:l}=A();try{return await $fetch(`${o.public.issuerUri}/connect/auth/${t}`,{method:"post",body:JSON.stringify({oauth:g,external:{code:f,redirect_uri:c},new:e}),parseResponse:d=>{const r=JSON.parse(d);if(r.AccessToken&&a(r.AccessToken),r.RefreshToken&&l(r.RefreshToken),r.CreateToken||r.RedirectURI)return{create_token:r.CreateToken?r.CreateToken:"",redirect_uri:r.RedirectURI?r.RedirectURI:""};throw d}})}catch{return""}},j=async(g,f)=>{const c=U(),{storeAccessToken:t,storeRefreshToken:e}=A();try{return await $fetch(`${c.public.issuerUri}/connect/auth/create`,{method:"post",body:JSON.stringify({oauth:g,create_token:f,new:!0}),parseResponse:o=>{const a=JSON.parse(o);if(a.AccessToken&&t(a.AccessToken),a.RefreshToken&&e(a.RefreshToken),a.RedirectURI)return a.RedirectURI;throw o}})}catch{return""}},z={key:0,class:"my-2"},D={key:1,class:"my-2"},M={key:2,class:"my-2"},W={class:"my-2"},X={class:"my-2"},ie=L({__name:"[method]",setup(g){const f=$(),c=N(),t=v(0),e=v(!1),o=v(!1),{getState:a}=I(),l=a(c.query.state.toString(),!0),d=v(""),r=()=>{C(l.RedirectUri,{external:!0})},b=async()=>{const u=await j(l,d.value);if(u){const n=new URL(u).searchParams.get("error");n?n=="access_denied"&&(e.value=!0,t.value=3):C(u,{external:!0})}else e.value=!0,t.value=2};return l?(async()=>{if(!c.query.code){e.value=!0,t.value=2;return}const u=c.query.code.toString(),i=`${window.location.origin}${f.resolve("/connect/external").href}/keycloak`,{create_token:n,redirect_uri:y}=await P(l,u,i,c.params.method.toString(),!1);if(n&&(d.value=n),y){const k=new URL(y).searchParams.get("error");k?k=="access_denied"?o.value=!0:k=="invalid_request"?(e.value=!0,t.value=1):k=="server_error"&&(e.value=!0,t.value=2):C(y,{external:!0})}else e.value=!0,t.value=2})():(e.value=!0,t.value=2),(u,i)=>(p(),T(q,{class:"h-100"},{default:h(()=>[!s(o)&&!s(e)?(p(),T(O,{key:0,class:"h-100"},{default:h(()=>[w(B,{class:"text-center align-content-center"},{default:h(()=>[w(J,{color:"primary",size:110,width:12,indeterminate:""})]),_:1})]),_:1})):R("",!0),w(E,{modelValue:s(e),"onUpdate:modelValue":i[0]||(i[0]=n=>V(e)?e.value=n:null),"show-save-action":!1,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Error Attempting Login","hide-extension":!0,"remove-button-spacer":!0,"close-action-label":"Close",onClose:r},{default:h(()=>[s(t)===1?(p(),x("p",z,_(s(m).messageCreateExternalError1),1)):R("",!0),s(t)===2?(p(),x("p",D,_(s(m).messageCreateExternalError2),1)):R("",!0),s(t)===3?(p(),x("p",M,_(s(m).messageCreateExternalError3),1)):R("",!0)]),_:1},8,["modelValue"]),w(E,{modelValue:s(o),"onUpdate:modelValue":i[1]||(i[1]=n=>V(o)?o.value=n:null),"show-save-action":!0,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Create new account","hide-extension":!0,"save-button-label":"Create Account",persistent:!0,"retain-focus":!0,onSave:b,onClose:r},{default:h(()=>[S("p",W,_(s(m).messageCreateExternalAccount1),1),S("p",X,_(s(m).messageCreateExternalAccount2),1)]),_:1},8,["modelValue"])]),_:1}))}});export{ie as default};
