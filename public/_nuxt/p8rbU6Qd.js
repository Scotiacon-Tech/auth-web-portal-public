import{T as O}from"./DeK7OrUp.js";import{u as L,m as j,n as h,r as C,o as $,p as x,w as l,b as t,c as z,q as H,F as R,d as m,s as te,v as a,x as le,g as M,y as ne,t as U,z as b,A as ie,a as S,B as Y,C as re}from"./fnzrKfsb.js";import{V as N,a as ae,_ as oe,l as B,b as G,c as J,d as K,e as P,f as Q,g as W,h as ue,i as se,j as de}from"./DWISroZa.js";import{V as D,a as q}from"./BgWllLN6.js";import{V as y}from"./gFY7h3vO.js";import{V as F}from"./g0TDB0Af.js";import{V as ce}from"./COH0YqBL.js";import{V as me}from"./H9GofMZs.js";import"./Y29-w6lM.js";import"./CIJBap5N.js";import"./hT7jcY3v.js";/* empty css        */import"./CsMOWluh.js";const ve=async()=>{const w=L(),v=O.getInstance().getTokenByService("graze");return await $fetch(`${w.public.issuerUri}/api/clients`,{method:"get",headers:{Authorization:`Bearer ${v==null?void 0:v.OAuthToken.AccessToken}`}})},pe=j({__name:"EditClientForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(w){const s=h(w,"modelValue"),v=L(),p=C({required:o=>!!o||"Required."}),k=()=>p.value.required(s.value.name)===!0;return s.value.redirect_uri.length===0&&s.value.redirect_uri.push(""),(o,d)=>($(),x(ae,{onSubmit:te(k,["stop"]),id:"login-form",action:`/${a(v).public.issuerUri}/api/clients`,method:"post"},{default:l(()=>[t(q,null,{default:l(()=>[t(D,{cols:"12"},{default:l(()=>[t(N,{modelValue:s.value.name,"onUpdate:modelValue":d[0]||(d[0]=f=>s.value.name=f),label:"Name",variant:"outlined",required:"",rules:[p.value.required]},null,8,["modelValue","rules"])]),_:1}),t(D,{cols:"12"},{default:l(()=>[t(N,{modelValue:s.value.description,"onUpdate:modelValue":d[1]||(d[1]=f=>s.value.description=f),label:"Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(q,null,{default:l(()=>[t(D,{cols:"12"},{default:l(()=>[($(!0),z(R,null,H(s.value.redirect_uri,(f,i)=>($(),x(N,{modelValue:s.value.redirect_uri[i],"onUpdate:modelValue":V=>s.value.redirect_uri[i]=V,label:"Redirect URL",variant:"outlined","append-icon":"mdi:mdi-window-close","onClick:append":V=>s.value.redirect_uri.length>1?s.value.redirect_uri.splice(i,1):""},null,8,["modelValue","onUpdate:modelValue","onClick:append"]))),256))]),_:1})]),_:1}),t(q,null,{default:l(()=>[t(D,null,{default:l(()=>[t(y,{onClick:d[2]||(d[2]=f=>s.value.redirect_uri.push("")),"prepend-icon":"mdi:mdi-plus",color:"primary"},{default:l(()=>d[3]||(d[3]=[m(" Add URI ")])),_:1})]),_:1})]),_:1})]),_:1},8,["action"]))}}),T="00000000-0000-0000-0000-000000000000",fe=j({__name:"ClientDialog",props:{modelValue:{required:!1},modelModifiers:{},clients:{required:!0},clientsModifiers:{},"request-delete":{type:Boolean,required:!1},"request-deleteModifiers":{}},emits:le(["error","secret"],["update:modelValue","update:clients","update:request-delete"]),setup(w,{emit:s}){const v=s,p=L(),k=O.getInstance(),o=h(w,"modelValue"),d=h(w,"clients"),f=h(w,"request-delete"),i=C(),V=C(!!o.value),A=C(),_=C(""),g=C(!1),r=C(!1);M(o,()=>{var c,e;A.value=void 0,o&&(i.value=B.cloneDeep(o.value),(c=i.value)!=null&&c.client_uuid&&((e=i.value)==null?void 0:e.client_uuid)!==T&&(A.value=()=>{r.value=!0})),V.value=!!o.value}),M(f,()=>{f.value&&(r.value=!0)}),M(r,()=>{r.value||(f.value=!1)});const u=(c,e=!1)=>{if(!c)return;const n=d.value.findIndex(ee=>ee.client_uuid==c.client_uuid);n>=0?e?d.value.splice(n,1):d.value.splice(n,1,B.cloneDeep(c)):d.value.push(B.cloneDeep(c))},E=async c=>{if(!o.value)return;const e=k.getTokenByService("graze");if(o.value.client_uuid&&o.value.client_uuid!==T)try{await $fetch(`${p.public.issuerUri}/api/client/${o.value.client_uuid}`,{method:"put",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`},body:{Client:i.value}})||v("error","Unexpected error encountered when updating client")}catch(n){v("error",`Error encountered when updating client: ${n}`)}else try{const n=await $fetch(`${p.public.issuerUri}/api/clients`,{method:"post",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`},body:{Client:i.value}});i.value=n.Client,u(i.value),g.value=!0,_.value=n.Secret}catch(n){v("error",`Error encountered when removing client: ${n}`)}o.value=void 0},X=async()=>{if(!o.value||!o.value.client_uuid)return;const c=k.getTokenByService("graze");try{await $fetch(`${p.public.issuerUri}/api/client/${o.value.client_uuid}`,{method:"delete",headers:{Authorization:`Bearer ${c==null?void 0:c.OAuthToken.AccessToken}`}})&&u(o.value,!0)}catch(e){v("error",`Error encountered when removing client: ${e}`)}o.value=void 0},I=async()=>{try{navigator.clipboard&&await navigator.clipboard.writeText(_.value)}catch(c){console.error(c.message)}},Z=async({callback:c})=>{const e=k.getTokenByService("graze");try{if(!o.value)return;const n=await $fetch(`${p.public.issuerUri}/api/client/${o.value.client_uuid}/secret`,{method:"get",headers:{Authorization:`Bearer ${e==null?void 0:e.OAuthToken.AccessToken}`}});n&&(g.value=!0,_.value=n.Secret)}catch(n){v("error",`Error encountered when removing client: ${n}`)}await c()};return(c,e)=>($(),z(R,null,[t(G,{modelValue:a(V),"onUpdate:modelValue":e[1]||(e[1]=n=>b(V)?V.value=n:null),onClose:e[2]||(e[2]=n=>o.value=void 0),onReset:e[3]||(e[3]=n=>i.value=a(B.cloneDeep)(o.value)),onSave:E,onDelete:a(A),"hide-extension":!0,"show-save-action":!0,"show-reset-action":!0,"show-close-action":!0,"close-action-label":a(i)&&a(i).client_uuid&&a(i).client_uuid!==a(T)?"Close":"Cancel"},ne({default:l(()=>[a(i)?($(),x(pe,{key:0,modelValue:a(i),"onUpdate:modelValue":e[0]||(e[0]=n=>b(i)?i.value=n:null)},null,8,["modelValue"])):ie("",!0)]),_:2},[a(i)?{name:"title",fn:l(()=>{var n;return[m(U(`${a(i).client_uuid&&a(i).client_uuid!==a(T)?`Edit: ${(n=a(i))==null?void 0:n.name}`:"Create Client"}`),1)]}),key:"0"}:void 0,a(i)&&a(i).client_uuid&&a(i).client_uuid!==a(T)?{name:"actions",fn:l(()=>[t(oe,{color:"red-darken-1",variant:"text",onClick:Z},{default:l(()=>e[11]||(e[11]=[m(" Regenerate Secret ")])),_:1})]),key:"1"}:void 0]),1032,["modelValue","onDelete","close-action-label"]),t(G,{modelValue:a(g),"onUpdate:modelValue":e[4]||(e[4]=n=>b(g)?g.value=n:null),"show-close-action":!0,"close-action-label":"Close","hide-extension":!0,title:"New Client Secret",onClose:e[5]||(e[5]=n=>{g.value=!1,_.value=""}),onSave:e[6]||(e[6]=n=>{I(),g.value=!1,_.value=""})},{default:l(()=>[e[12]||(e[12]=S("p",{class:"mb-4"}," The following secret was generated, it will not be displayed again: ",-1)),S("p",null,[S("span",{onClick:I,class:"cursor-pointer"},U(a(_)),1),t(y,{"append-icon":"mdi:mdi-clipboard-outline",size:"medium",variant:"text",class:"ml-3",onClick:I})])]),_:1},8,["modelValue"]),t(ue,{modelValue:a(r),"onUpdate:modelValue":e[10]||(e[10]=n=>b(r)?r.value=n:null)},{default:l(()=>[t(J,{color:"error"},{default:l(()=>[t(K,null,{default:l(()=>[t(P,{class:"d-flex"},{default:l(()=>[e[13]||(e[13]=m(" Confirmation Required ")),t(F),t(y,{icon:"mdi:mdi-close",size:"x-small",variant:"text",onClick:e[7]||(e[7]=n=>r.value=!1)})]),_:1})]),_:1}),t(Q,null,{default:l(()=>e[14]||(e[14]=[S("p",{class:"mb-4"},"Are you sure you wish to delete this client?",-1),S("p",null,"Any services logging in with this client identity and secret will cease to function.",-1)])),_:1}),t(W,null,{default:l(()=>[t(y,{onClick:e[8]||(e[8]=n=>r.value=!1)},{default:l(()=>e[15]||(e[15]=[m(" Close Dialog ")])),_:1}),t(F),t(y,{onClick:e[9]||(e[9]=n=>{r.value=!1,X()})},{default:l(()=>e[16]||(e[16]=[m(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ae=j({__name:"dashboard",async setup(w){let s,v;const p=C(),k=C(!1),o=C(""),d=O.getInstance(),f=d.getTokenByService("graze");(!f||d.accessTimeRemaining(f)<=0)&&Y("/admin");const i=C([]),V=C(!1);try{i.value=([s,v]=re(()=>ve()),s=await s,v(),s)}catch(g){g.message.includes("403")&&(d.removeTokensByService("graze"),Y(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const A=()=>({id:0,client_uuid:T,name:"",description:"",secret:"",redirect_uri:[""],style:{}}),_=g=>{o.value=g,k.value=!0};return(g,r)=>($(),x(ce,null,{default:l(()=>[t(q,null,{default:l(()=>[t(D,null,{default:l(()=>[($(!0),z(R,null,H(a(i),u=>($(),x(J,{color:"grey-lighten-3",variant:"elevated",elevation:"16"},{default:l(()=>[t(K,null,{default:l(()=>[t(P,null,{default:l(()=>[m(U(u.name),1)]),_:2},1024),t(de,null,{default:l(()=>[m(U(u.description),1)]),_:2},1024)]),_:2},1024),t(Q,null,{default:l(()=>[m(" RedirectURI"+U(u.redirect_uri&&u.redirect_uri.length>1?"s":"")+": ",1),u.redirect_uri&&u.redirect_uri.length>0?($(),x(me,{key:0,items:u.redirect_uri,density:"compact","bg-color":"transparent",class:"text-medium-emphasis"},null,8,["items"])):($(),z(R,{key:1},[m(" Unset ")],64))]),_:2},1024),t(W,null,{default:l(()=>[t(y,{color:"error","prepend-icon":"mdi:mdi-delete",variant:"elevated",onClick:E=>{p.value=u,V.value=!0}},{default:l(()=>r[6]||(r[6]=[m(" Delete ")])),_:2},1032,["onClick"]),t(F),t(y,{color:"primary","prepend-icon":"mdi:mdi-pencil",variant:"elevated",onClick:E=>p.value=u},{default:l(()=>r[7]||(r[7]=[m(" Edit ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),t(q,null,{default:l(()=>[t(D,{class:"text-right"},{default:l(()=>[t(y,{"prepend-icon":"mdi:mdi-plus",color:"primary",onClick:r[0]||(r[0]=u=>p.value=A())},{default:l(()=>r[8]||(r[8]=[m(" Add Client ")])),_:1})]),_:1})]),_:1}),t(fe,{modelValue:a(p),"onUpdate:modelValue":r[1]||(r[1]=u=>b(p)?p.value=u:null),clients:a(i),"onUpdate:clients":r[2]||(r[2]=u=>b(i)?i.value=u:null),requestDelete:a(V),"onUpdate:requestDelete":r[3]||(r[3]=u=>b(V)?V.value=u:null),onError:_},null,8,["modelValue","clients","requestDelete"]),t(se,{modelValue:a(k),"onUpdate:modelValue":r[5]||(r[5]=u=>b(k)?k.value=u:null),timeout:5e3,"multi-line":""},{actions:l(()=>[t(y,{color:"white",variant:"text",onClick:r[4]||(r[4]=u=>k.value=!1)},{default:l(()=>r[9]||(r[9]=[m(" Close ")])),_:1})]),default:l(()=>[m(U(a(o))+" ",1)]),_:1},8,["modelValue"])]),_:1}))}});export{Ae as default};
