import{s as e}from"./DeTKzWR2.js";import{T as A,r as c,v as O,o as f,Y as k,w as b,d as F,t as m,c as T,X as C,ac as z,_ as R,a0 as U,a1 as M,K as q,M as D,V as i,b as w,a as y,W as B,N as J,a8 as I}from"./CAOQfWXx.js";import{v as K}from"./BpP4Qw09.js";import{u as x}from"./DSs4YqFl.js";import{j as S}from"./CZ89NzH9.js";import{u as G}from"./CKgcwGBl.js";import{a as P,V as W}from"./8jOmeCJr.js";const X={key:0,class:"ml-1"},Y=A({__name:"AuthButton",props:{appendIcon:{type:[String,Array,Function,Object],default:""},class:{default:""},credential:{},showUsername:{type:Boolean,default:!1},source:{default:"internal"}},setup(o){const n={amazon:{icon:"fa:fas fa-brands fa-amazon",label:e.buttonLoginAmazon,name:"Amazon"},email:{icon:"mdi:mdi-email",label:e.buttonLoginEmail,name:"Email"},facebook:{icon:"fa:fa fa-brands fa-facebook",label:e.buttonLoginFaceBook,name:"FaceBook"},google:{icon:"fa:fa fa-brands fa-google",label:e.buttonLoginGoogle,name:"Google"},internal:{icon:"mdi:mdi-email",label:e.buttonLoginEmail,name:"Email"},instagram:{icon:"fa:fa fa-brands fa-instagram",label:e.buttonLoginInstagram,name:"Instagram"},keycloak:{icon:"mdi:mdi-key-variant",label:e.buttonLoginKeycloak,name:"Keycloak"},microsoft:{icon:"fa:fa fa-brands fa-windows",label:e.buttonLoginMicrosoft,name:"Microsoft"},steam:{icon:"fa:fa fa-brands fa-steam",label:e.buttonLoginSteam,name:"Steam"},telegram:{icon:"fa:fa fa-brands fa-telegram",label:e.buttonLoginTelegram,name:"Telegram"},twitch:{icon:"fa:fa fa-brands fa-twitch",label:e.buttonLoginTwitch,name:"Twitch"},twitter:{icon:"fa:fa fa-brands fa-twitter",label:e.buttonLoginTwitter,name:"Twitter"}},d=c(n[o.source.toLowerCase()].label||""),g=c(n[o.source.toLowerCase()].icon||""),u=O(()=>{var s,r;if(o.source.toLowerCase()==="internal"||o.source.toLowerCase()==="email")return(s=o.credential)==null?void 0:s.Email;try{const a=JSON.parse(((r=o.credential)==null?void 0:r.Data)||"{}");switch(o.source.toLowerCase()){case"telegram":return`@${a.username||a.id}`}}catch{}return""});return(s,r)=>(f(),k(K,{"append-icon":s.appendIcon,"prepend-icon":g.value,class:z(`${s.source.toLowerCase()} ${o.class}`)},{default:b(()=>[F(m(d.value)+" ",1),s.showUsername&&s.credential?(f(),T("small",X,"("+m(u.value)+")",1)):C("",!0)]),_:1},8,["append-icon","prepend-icon","class"]))}}),E=R(Y,[["__scopeId","data-v-169c8e1b"]]),V=async(o,n,d=!1)=>{const g=U(),{storeAccessToken:u,storeRefreshToken:s}=G();return await $fetch(`${g.public.issuerUri}/connect/auth/telegram`,{method:"post",body:JSON.stringify({oauth:o,telegram:n,new:d}),parseResponse:r=>{const a=JSON.parse(r);if(a.AccessToken&&u(a.AccessToken),a.RefreshToken&&s(a.RefreshToken),a.RedirectURI)return a.RedirectURI;throw r}})},H={key:0,class:"my-2"},Q={key:1,class:"my-2"},Z={class:"my-2"},ee={class:"my-2"},ae={class:"my-2"},te=A({__name:"TelegramButton",props:{appendIcon:{type:[String,Array,Function,Object],default:""},class:{default:""},credential:{},showUsername:{type:Boolean,default:!1}},emits:["cancel"],setup(o,{emit:n}){const d=n,g=U();let u=c("");g.public.telegramBotId&&(u.value=g.public.telegramBotId);const s=x(),r=c(!1),a=c(!1),h=c(0),L=c();c();const _=c(),$=async()=>{if(r.value=!1,!L.value)return;const t=await V(s,L.value,!0);t&&I(t,{external:!0})},j=()=>{{if(!window.Telegram||!window.Telegram.Login||!window.Telegram.Login.auth){console.error("Telegram not initialised");return}window.Telegram.Login.auth({bot_id:u.value,request_access:!0},t=>{t||console.error("Telegram Authorization Failed"),N(t)})}},N=async t=>{const l=await V(s,t,!1);if(l){const v=new URL(l).searchParams.get("error");v?v=="access_denied"?(r.value=!0,L.value=t):v=="invalid_request"?(a.value=!0,h.value=1):v=="server_error"&&(a.value=!0,h.value=2):I(l,{external:!0})}};return M(()=>{const t=document.createElement("script");t.async=!0,t.src="https://telegram.org/js/telegram-widget.js?22",_.value.appendChild(t)}),(t,l)=>(f(),T(J,null,[q(w(W,null,{default:b(()=>[w(P,{class:"text-center"},{default:b(()=>[y("div",{ref_key:"telegram",ref:_},null,512),w(E,{"append-icon":t.appendIcon,credential:t.credential,"show-username":t.showUsername,source:"telegram",class:"d-flex justify-start w-100",onClick:j},null,8,["append-icon","credential","show-username"])]),_:1})]),_:1},512),[[D,i(u)]]),w(S,{modelValue:i(a),"onUpdate:modelValue":l[0]||(l[0]=p=>B(a)?a.value=p:null),"show-save-action":!1,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Error Attempting Telegram Login","hide-extension":!0,"remove-button-spacer":!0,"close-action-label":"Close",onClose:l[1]||(l[1]=p=>a.value=!1)},{default:b(()=>[i(h)===1?(f(),T("p",H,m(i(e).messageCreateTelegramError1),1)):C("",!0),i(h)===2?(f(),T("p",Q,m(i(e).messageCreateTelegramError2),1)):C("",!0)]),_:1},8,["modelValue"]),w(S,{modelValue:i(r),"onUpdate:modelValue":l[2]||(l[2]=p=>B(r)?r.value=p:null),"show-save-action":!0,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Create new account","hide-extension":!0,"save-button-label":"Create Account",onSave:$,onClose:l[3]||(l[3]=p=>d("cancel"))},{default:b(()=>[y("p",Z,m(i(e).messageCreateTelegramAccount1),1),y("p",ee,m(i(e).messageCreateTelegramAccount2),1),y("p",ae,m(i(e).messageCreateTelegramAccount3),1)]),_:1},8,["modelValue"])],64))}}),oe=A({__name:"LoginButton",props:{appendIcon:{type:[String,Array,Function,Object],default:""},credential:{},params:{},showUsername:{type:Boolean,default:!1},source:{default:"internal"}},setup(o){return(n,d)=>n.source=="telegram"?(f(),k(te,{key:0})):(f(),k(E,{key:1,"append-icon":n.appendIcon,credential:n.credential,"show-username":n.showUsername,source:n.source,class:"d-flex justify-start w-100"},null,8,["append-icon","credential","show-username","source"]))}}),me=R(oe,[["__scopeId","data-v-9a086b0f"]]);export{E as A,me as L};
